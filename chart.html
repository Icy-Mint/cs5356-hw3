<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Energy Donut Chart</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    svg {
      width: 500px;
      height: 500px;
    }

    .arc text {
      font-size: 12px;
      fill: white;
      text-anchor: middle;
    }

    .center-label {
      font-size: 16px;
      font-weight: bold;
      text-anchor: middle;
      fill: #333;
    }
  </style>
</head>
<body>
  <svg></svg>

  <script>
    const width = 500, height = 500, radius = Math.min(width, height) / 2;
    const svg = d3.select("svg")
                  .append("g")
                  .attr("transform", `translate(${width / 2}, ${height / 2})`);

    const color = d3.scaleOrdinal(d3.schemeTableau10);

    d3.csv("raw_data.csv").then(data => {
      const totalRow = data.find(row => row[""] === "Summed total");
      const energyData = Object.entries(totalRow)
        .filter(([key, _]) => key !== "")
        .map(([key, value]) => ({
          label: key,
          value: parseFloat(value)
        }));

      const total = d3.sum(energyData, d => d.value);

      const pie = d3.pie().value(d => d.value);
      const arc = d3.arc().innerRadius(radius * 0.6).outerRadius(radius * 0.9);

      const arcs = svg.selectAll("arc")
                      .data(pie(energyData))
                      .enter()
                      .append("g")
                      .attr("class", "arc");

      arcs.append("path")
          .attr("d", arc)
          .attr("fill", d => color(d.data.label));

      arcs.append("text")
          .attr("transform", d => `translate(${arc.centroid(d)})`)
          .text(d => `${((d.data.value / total) * 100).toFixed(1)}%`);

      svg.append("text")
         .attr("class", "center-label")
         .attr("dy", "0.35em")
         .text(`${(total / 1000).toFixed(1)} MBtu/sf/year`);
    });
  </script>
</body>
</html>